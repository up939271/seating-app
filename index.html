<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Seating Arrangement For Kharis</title>

  <!-- ===================== -->
  <!-- 1.A OFFLINE / PWA TAGS -->
  <!-- ===================== -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#111827">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Kharis Seating">

  <style>
    :root{
      --main1: #7c3aed;
      --main2: #2563eb;
      --otherGlow: rgba(17,24,39,0.06);
      --text: #111827;
      --muted: #6b7280;
      --bg: #f8fafc;
      --card: #ffffff;
      --danger: #dc2626;
      --border: #e5e7eb;
      --chair: #111827;
    }

    * { box-sizing: border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
    }

    .wrap{ max-width:1200px; margin:0 auto; padding:12px; }

    .panel{
      position:sticky; top:0; z-index:50;
      background:rgba(255,255,255,.92);
      backdrop-filter:blur(8px);
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .title h1{ font-size:15px; margin:0; }
    .title p{ font-size:11px; margin:0; color:var(--muted); }

    .controls{ display:flex; gap:8px; }

    button{
      border:1px solid #d1d5db;
      background:#111827;
      color:#fff;
      padding:9px 10px;
      border-radius:10px;
      font-weight:800;
      font-size:13px;
      min-height:40px;
    }
    button.danger{ background:var(--danger); border-color:var(--danger); }

    .seating-area{
      margin-top:12px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
    }

    .row-label{
      font-size:12px;
      font-weight:900;
      margin-bottom:6px;
    }

    .row-scroll{ overflow-x:auto; }
    .row{
      display:grid;
      gap:4px;
      margin-bottom:10px;
    }

    .seat{
      min-width:74px;
      max-width:74px;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:10px;
      padding:6px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      position:relative;
    }

    .seat::before{
      content:"";
      position:absolute;
      inset:2px;
      border-radius:9px;
      background:var(--otherGlow);
      z-index:0;
    }
    .seat > *{ position:relative; z-index:1; }

    .seat.main1::before{ background:color-mix(in srgb, var(--main1) 18%, white); }
    .seat.main2::before{ background:color-mix(in srgb, var(--main2) 18%, white); }

    .chair-wrap{
      width:40px; height:40px;
      display:grid; place-items:center;
    }
    .chair-icon{ width:28px; height:28px; }
    .chair-icon path{ fill:var(--chair); }

    .seat-label{ font-size:10px; font-weight:900; }

    .seat input{
      width:100%;
      font-size:12px;
      padding:6px;
      border-radius:8px;
      border:1px solid #d1d5db;
      text-align:center;
    }

    .role-badge{
      position:absolute;
      top:4px; right:5px;
      font-size:9px;
      font-weight:900;
      padding:2px 6px;
      background:#fff;
      border-radius:999px;
      border:1px solid #e5e7eb;
    }

    .modal-backdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,.5);
      display:none;
      align-items:flex-end;
      padding:12px;
      z-index:1000;
    }

    .modal{
      width:100%;
      background:#fff;
      border-radius:16px;
      border:1px solid #e5e7eb;
    }

    .modal-header, .modal-body, .modal-actions{
      padding:12px 14px;
    }

    .modal-actions{ display:grid; gap:10px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="panel">
      <div class="title">
        <h1>Seating Arrangement For Kharis</h1>
        <p>Tap a chair to assign GS (purple) or Pas. Awo (blue)</p>
      </div>
      <div class="controls">
        <button id="setupBtn">Set Up</button>
        <button id="startOverBtn" class="danger">Start Over</button>
      </div>
    </div>

    <div class="seating-area">
      <div class="row-label">Back Row</div>
      <div class="row-scroll"><div id="backRow" class="row"></div></div>

      <div class="row-label">Front Row</div>
      <div class="row-scroll"><div id="frontRow" class="row"></div></div>
    </div>
  </div>

  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header"><strong>Seat Options</strong></div>
      <div class="modal-actions">
        <button id="setMain1Btn">Set GS (Purple)</button>
        <button id="setMain2Btn">Set Pas. Awo (Blue)</button>
        <button id="clearMainBtn">Clear</button>
      </div>
    </div>
  </div>

  <script>
    const KEY_STATE = "kharis_seating_offline";
    const backRow = document.getElementById("backRow");
    const frontRow = document.getElementById("frontRow");
    const modal = document.getElementById("modalBackdrop");
    let state = JSON.parse(localStorage.getItem(KEY_STATE) || "null");
    let activeSeat = null;

    function chairSvg(){
      return `
      <svg class="chair-icon" viewBox="0 0 64 64">
        <path d="M22 8h20c2 0 4 2 4 4v20H18V12c0-2 2-4 4-4z"/>
        <path d="M14 32h36c2 0 4 2 4 4v8H10v-8c0-2 2-4 4-4z"/>
        <path d="M16 44h8v12h-8z"/>
        <path d="M40 44h8v12h-8z"/>
      </svg>`;
    }

    function build(n){
      state={total:n, front:[], back:[], main1:null, main2:null};
      const f=Math.ceil(n/2), b=n-f;
      for(let i=1;i<=f;i++) state.front.push({id:`f${i}`,name:""});
      for(let i=1;i<=b;i++) state.back.push({id:`b${i}`,name:""});
      save(); render();
    }

    function save(){ localStorage.setItem(KEY_STATE, JSON.stringify(state)); }

    function renderRow(el, seats){
      el.innerHTML="";
      seats.forEach((s,i)=>{
        const d=document.createElement("div");
        d.className="seat";
        if(s.id===state.main1) d.classList.add("main1");
        if(s.id===state.main2) d.classList.add("main2");
        d.innerHTML=`
          <div class="role-badge">${s.id===state.main1?"GS":s.id===state.main2?"PA":"-"}</div>
          <div class="chair-wrap">${chairSvg()}</div>
          <div class="seat-label">Seat ${i+1}</div>
          <input value="${s.name||""}">
        `;
        d.onclick=()=>{activeSeat=s.id; modal.style.display="flex";}
        d.querySelector("input").oninput=e=>{s.name=e.target.value; save();}
        el.appendChild(d);
      });
    }

    function render(){
      backRow.style.gridTemplateColumns=`repeat(${state.back.length},74px)`;
      frontRow.style.gridTemplateColumns=`repeat(${state.front.length},74px)`;
      renderRow(backRow,state.back);
      renderRow(frontRow,state.front);
    }

    document.getElementById("setMain1Btn").onclick=()=>{state.main1=activeSeat; save(); render(); modal.style.display="none";}
    document.getElementById("setMain2Btn").onclick=()=>{state.main2=activeSeat; save(); render(); modal.style.display="none";}
    document.getElementById("clearMainBtn").onclick=()=>{if(state.main1===activeSeat)state.main1=null;if(state.main2===activeSeat)state.main2=null; save(); render(); modal.style.display="none";}

    document.getElementById("setupBtn").onclick=()=>{const n=prompt("Total seats?"); if(n) build(+n);}
    document.getElementById("startOverBtn").onclick=()=>{localStorage.clear(); location.reload();}

    if(state) render();
 <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", async () => {
      try {
        const reg = await navigator.serviceWorker.register("/seating-app/sw.js");
        if (reg.update) reg.update();
      } catch (e) {
        console.log("Service worker registration failed:", e);
      }
    });
  }
</script>

</body>
</html>
